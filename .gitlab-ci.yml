include:
  - template: Code-Quality.gitlab-ci.yml
  - project: widas/software-quality/gitlab-template-projects/widas-kubernetes-ci-templates
    file: templates/.kube-deploy.yml
  - project: widas/software-quality/gitlab-template-projects/widas-ci-templates
    file: 
      - common/docker.yml
      - common/deployment.yml

variables:
  DOCKER_DRIVER: overlay2
  TEMPLATE_REPO: https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.widas.de/widas/software-quality/gitlab-template-projects/widas-ci-templates
  SCRIPTS_PATH: widas-ci-templates/ci-scripts
  DEPLOYMENT_YML_PATH: widas-ci-templates/deployment-ymls/service-without-ingress.yml.j2


stages:
  - test
  - package
  # - release
  - publish

# release:
#   image: docker-registry.widas.de:5050/dockerregistry/common/semantic-release:v1.0.5
#   stage: release
#   script:
#     - semantic-release
#   only:
#     - master

kube_deployment:
  extends: .kube_deployment

# deploy:
#   extends: .deploy_kube
#   stage: publish
#   variables:
#     VALUE_FILE_SUFFIX: test
#     TEMPLATE_REPO: https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.widas.de/widas/software-quality/gitlab-template-projects/widas-kubernetes-ci-templates.git
#     CIDAAS_CI_TEMPLATE: "widas-kubernetes-ci-templates/deployment_ymls/cidaas-service-all-in-one.yml.j2"
#     KUBECONFIG_FILE: $wimcon1_loadtest_01_custom
#     DOCKER_IMAGE: $DOCKER_REGISTRY/$CI_PROJECT_PATH:$CI_COMMIT_REF_SLUG-$CI_COMMIT_SHA-$CI_PIPELINE_ID
#   only:
#     - master
